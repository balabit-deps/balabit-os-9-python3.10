Backport of:

From f25509e78e8be6ea73c811ac2b8c928c28841b9f Mon Sep 17 00:00:00 2001
From: Seth Michael Larson <seth@python.org>
Date: Tue, 20 Jan 2026 14:45:58 -0600
Subject: [PATCH] gh-143925: Reject control characters in data: URL mediatypes

---
 Lib/test/test_urllib.py                                   | 8 ++++++++
 Lib/urllib/request.py                                     | 5 +++++
 .../2026-01-16-11-51-19.gh-issue-143925.mrtcHW.rst        | 1 +
 3 files changed, 14 insertions(+)
 create mode 100644 Misc/NEWS.d/next/Security/2026-01-16-11-51-19.gh-issue-143925.mrtcHW.rst

--- python3.10-3.10.12.orig/Lib/test/test_urllib.py
+++ python3.10-3.10.12/Lib/test/test_urllib.py
@@ -10,6 +10,7 @@ import unittest
 from unittest.mock import patch
 from test import support
 from test.support import os_helper
+from test.support import control_characters_c0
 from test.support import warnings_helper
 import os
 try:
@@ -683,6 +684,13 @@ class urlopen_DataTests(unittest.TestCas
         # missing padding character
         self.assertRaises(ValueError,urllib.request.urlopen,'data:;base64,Cg=')
 
+    def test_invalid_mediatype(self):
+        for c0 in control_characters_c0():
+            self.assertRaises(ValueError,urllib.request.urlopen,
+                              f'data:text/html;{c0},data')
+        for c0 in control_characters_c0():
+            self.assertRaises(ValueError,urllib.request.urlopen,
+                              f'data:text/html{c0};base64,ZGF0YQ==')
 
 class urlretrieve_FileTests(unittest.TestCase):
     """Test urllib.urlretrieve() on local files"""
--- python3.10-3.10.12.orig/Lib/urllib/request.py
+++ python3.10-3.10.12/Lib/urllib/request.py
@@ -1654,6 +1654,11 @@ class DataHandler(BaseHandler):
         scheme, data = url.split(":",1)
         mediatype, data = data.split(",",1)
 
+        # Disallow control characters within mediatype.
+        if re.search(r"[\x00-\x1F\x7F]", mediatype):
+            raise ValueError(
+                "Control characters not allowed in data: mediatype")
+
         # even base64 encoded data URLs might be quoted so unquote in any case:
         data = unquote_to_bytes(data)
         if mediatype.endswith(";base64"):
